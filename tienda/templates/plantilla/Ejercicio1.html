{% extends "base.html" %}

{% block titulo %}Ejercicio 1B1{% endblock %}

{% block contenido %}

<div style="background-color: #f2f2f2; padding: 20px; border-radius: 10px; margin-bottom: 30px;">
    <h2 style="font-weight: bold;">Restaurant Ming</h2>
    <p>Le restaurant Ming √† Rolle offre √† ses clients une atmosph√®re unique et une cuisine chinoise exquise.
        La cuisine classique de P√©kin fait partie de nos sp√©cialit√©s. Vous trouverez dans notre carte riche et
        vari√©e √©galement des plats originaires du nord-ouest de la Chine ainsi que du Tibet. Grand choix de mets
        v√©g√©tariens.</p>
    <p><strong>Prix raisonnables:</strong> plats principaux entre 12 CHF et 21 CHF, entr√©es et accompagnements d√®s 4
        CHF.</p>
    <p>Grande salle spacieuse avec vue sur le lac L√©man et salles s√©par√©es pour r√©ceptions priv√©es et √©v√®nements
        particuliers.
        Nombreuses places de parc √† disposition.</p>
    <p>R√©servations de tables d√®s 10h30 au 021 825 10 66. Pour des r√©servations pour des groupes et √©v√®nements
        particuliers,
        veuillez nous contacter par e-mail: <strong>info@restaurantming.ch</strong>, afin de recevoir nos offres et
        propositions.</p>
</div>

<div style="border: 1px solid #000; padding: 20px; border-radius: 10px; max-width: 600px;">
    <h3>Restaurant Ming</h3>

    {% if mensaje %}
    <div class="alert alert-success" role="alert">
        {{ mensaje }}
    </div>
    {% endif %}

    {% if errores %}
    <div class="alert alert-warning mt-3">
        <ul>
            {% for error in errores %}
            <li>{{ error }}</li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}

    <!-- CAMBIAR ESTA L√çNEA: a√±ade id="formulario" al form -->
    <form method="post" action="{% url 'ejercicio1' %}" class="needs-validation" novalidate id="formulario">
        {% csrf_token %}

        <!-- Checkbox separado -->
        <div class="form-check mb-3">
            {{ form.guardar_historial }}
            <label class="form-check-label" for="{{ form.guardar_historial.id_for_label }}">
                {{ form.guardar_historial.label }}
            </label>
        </div>

        <!-- Campos restantes -->
        {% for field in form %}
        {% if field.name != 'guardar_historial' %}
        <div class="mb-3">
            <label for="{{ field.id_for_label }}" class="form-label"><strong>{{ field.label }}:</strong></label>
            {{ field }}
            <div class="invalid-feedback" style="display:block;">
                {% if field.errors %}
                ‚ùå {{ field.errors.0 }} üòû
                {% endif %}
            </div>
            <div class="valid-feedback" style="display:block;">
                {% if not field.errors %}
                ‚úÖ Bien rempli ! üòä
                {% endif %}
            </div>
        </div>
        {% endif %}
        {% endfor %}
        {% if request.user.username == "marilyn" %}
        <button type="submit" class="btn btn-success" style="margin-top: 20px;">Enregistrer</button>
        {% endif %}
        <button type="button" class="btn btn-secondary" style="margin-top: 20px; margin-left: 10px;"
            onclick="limpiarFormulario()">R√©initialiser</button>
        <a href="{% url 'ejercicio2' %}" class="btn btn-primary" style="margin-top: 20px; margin-left: 10px;">Exercice
            suivant</a>
    </form>
</div>

<script>
    // Validaci√≥n Bootstrap
    (function () {
        'use strict';
        var forms = document.querySelectorAll('.needs-validation');

        Array.prototype.slice.call(forms).forEach(function (form) {
            form.addEventListener('submit', function (event) {
                if (!form.checkValidity()) {
                    event.preventDefault();
                    event.stopPropagation();
                }
                form.classList.add('was-validated');
            }, false);
        });
    })();

    // Funci√≥n para limpiar campos del formulario
    function limpiarFormulario() {
        const form = document.getElementById("formulario");

        form.querySelectorAll('input, textarea, select').forEach(field => {
            const nombreCampo = field.name;

            // Evita limpiar CSRF, checkbox y los campos protegidos
            if (
                nombreCampo !== 'csrfmiddlewaretoken' &&
                nombreCampo !== 'guardar_historial' &&
                nombreCampo !== 'comentario' &&
                nombreCampo !== 'nota'
            ) {
                if (field.type === 'checkbox' || field.type === 'radio') {
                    field.checked = false;
                } else {
                    field.value = '';
                }
                field.removeAttribute('readonly');
                field.removeAttribute('disabled');
                field.classList.remove('is-valid', 'is-invalid');
            }
        });

        form.classList.remove('was-validated');
        form.querySelectorAll('.valid-feedback, .invalid-feedback').forEach(el => el.style.display = 'none');
    }

    // Control autom√°tico del checkbox
    document.addEventListener("DOMContentLoaded", function () {
        const checkbox = document.getElementById('guardar_historial');
        const form = document.getElementById("formulario");

        if (checkbox && form) {
            checkbox.addEventListener("change", function () {
                if (checkbox.checked) {
                    console.log("‚úÖ Checkbox marcado: se enviar√° el formulario.");
                    form.noValidate = true;  // Omitimos validaci√≥n si quieres
                    form.submit();
                } else {
                    console.log("üîÑ Checkbox desmarcado: limpiando y desbloqueando formulario.");
                    limpiarFormulario(); // Limpia
                }
            });
        }
    });
</script>


{% endblock %}